{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Edit Student Attendance</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;background:#f1f5f9}

/* ===== HEADER ===== */
.header{
    background:#119eea;
    color:white;
    padding:20px 30px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

/* ===== CONTAINER ===== */
.container{
    padding:30px;
    max-width:1100px;
    margin:auto;
}

/* ===== CARD ===== */
.card{
    background:white;
    padding:25px;
    border-radius:16px;
    box-shadow:0 10px 25px rgba(0,0,0,.1);
    margin-bottom:25px;
}

/* ===== FORM ===== */
.form-group{
    margin-bottom:18px;
}
label{
    font-weight:600;
    display:block;
    margin-bottom:6px;
}
select,input{
    width:100%;
    padding:12px;
    border-radius:8px;
    border:1px solid #cbd5f5;
    font-size:15px;
}
input:focus,select:focus{
    outline:none;
    border-color:#3b82f6;
}

/* ===== BUTTONS ===== */
.btn{
    padding:12px 26px;
    border:none;
    border-radius:8px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    transition:.3s;
}
.btn-present{background:#22c55e;color:white}
.btn-absent{background:#ef4444;color:white}
.btn-save{
    background:linear-gradient(135deg,#3b82f6,#2563eb);
    color:white;
}
.btn:hover{opacity:.9}

/* ===== TABLE ===== */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    padding:14px;
    text-align:center;
}
th{
    background:#0f172a;
    color:white;
}
tr:nth-child(even){background:#f8fafc}

/* ===== BADGES ===== */
.badge{
    padding:6px 12px;
    border-radius:20px;
    font-weight:600;
}
.present{background:#bbf7d0;color:#065f46}
.absent{background:#fecaca;color:#7f1d1d}

/* ===== TOP BAR ===== */
.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
}
.back-btn{
    padding:10px 18px;
    background:linear-gradient(135deg,#3b82f6,#2563eb);
    color:white;
    text-decoration:none;
    border-radius:8px;
    font-weight:600;
}
.back-btn:hover{opacity:.9}
</style>
</head>

<body>

<div class="header">
    <h2>üìù Edit Student Attendance</h2>
    <span>{{ request.user.username }}</span>
</div>

<div class="container">

<div class="top-bar">
    <h2>‚úè Manual Attendance Control</h2>
    <a href="{% url 'faculty_dashboard' %}" class="back-btn">‚Üê Faculty Dashboard</a>
</div>

<!-- ===== SELECT STUDENT ===== -->
<div class="card">
    <form method="GET">
        <div class="form-group">
            <label>Select Student</label>
            <select name="student_id" onchange="this.form.submit()">
                <option value="">-- Select Student --</option>
                {% for s in students %}
                <option value="{{ s.id }}" {% if selected_student and s.id == selected_student.id %}selected{% endif %}>
                    {{ s.name }} ({{ s.roll_no }})
                </option>
                {% endfor %}
            </select>
        </div>
    </form>
</div>

{% if selected_student %}

<!-- ===== ADD / UPDATE ATTENDANCE ===== -->
<div class="card">
    <h3>‚ûï Add / Update Attendance</h3>

    <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="student_id" value="{{ selected_student.id }}">

        <div class="form-group">
            <label>Date</label>
            <input type="date" name="date" required>
        </div>

        <div class="form-group">
            <label>Status</label>
            <select name="status">
                <option value="Present">Present</option>
                <option value="Absent">Absent</option>
            </select>
        </div>

        <button class="btn btn-save" type="submit">üíæ Save Attendance</button>
    </form>
</div>

<!-- ===== ATTENDANCE HISTORY ===== -->
<div class="card">
    <h3>üìÖ Attendance History</h3>

    <table>
        <tr>
            <th>Date</th>
            <th>Status</th>
            <th>Marked By</th>
        </tr>

        {% for a in attendance %}
        <tr>
            <td>{{ a.date }}</td>
            <td>
                <span class="badge {% if a.status == 'Present' %}present{% else %}absent{% endif %}">
                    {{ a.status }}
                </span>
            </td>
            <td>
                {% if a.marked_by_face %}
                    ü§ñ Face Scan
                {% elif a.auto_marked %}
                    ‚è± Auto Absent
                {% else %}
                    ‚úç Manual
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="3">No attendance records</td></tr>
        {% endfor %}
    </table>
</div>

{% endif %}

</div>
</body>
</html>
