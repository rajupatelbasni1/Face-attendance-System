{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faculty Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;background:#f1f5f9}

/* ===== LAYOUT ===== */
.container{display:flex;min-height:100vh}

/* ===== SIDEBAR ===== */
.sidebar{
    width:260px;
    background:#0f172a;
    color:white;
    padding:25px;
}
.sidebar h2{text-align:center;margin-bottom:25px}

.profile{
    text-align:center;
    margin-bottom:30px;
}
.profile strong{font-size:16px}
.profile p{font-size:13px;color:#cbd5f5;margin-top:4px}

.sidebar a{
    display:block;
    padding:12px 16px;
    margin-bottom:12px;
    color:white;
    text-decoration:none;
    border-radius:10px;
    transition:.3s;
}
.sidebar a:hover{
    background:#1e293b;
    transform:translateX(6px);
}

/* ===== MAIN ===== */
.main{flex:1;padding:30px}

/* ===== HEADER ===== */
.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
}

/* ===== CARDS ===== */
.cards{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
    margin-bottom:30px;
}
.card{
    padding:22px;
    border-radius:18px;
    color:white;
    box-shadow:0 12px 25px rgba(0,0,0,.15);
}
.green{background:linear-gradient(135deg,#22c55e,#16a34a)}
.blue{background:linear-gradient(135deg,#3b82f6,#2563eb)}
.red{background:linear-gradient(135deg,#ef4444,#b91c1c)}
.card h3{margin:0;font-size:16px}
.card p{font-size:28px;margin-top:8px;font-weight:600}

/* ===== SEARCH ===== */
.search-box{
    background:white;
    padding:20px;
    border-radius:18px;
    margin-bottom:20px;
    box-shadow:0 8px 18px rgba(0,0,0,.1);
}
.search-box input{
    width:100%;
    padding:14px;
    border-radius:10px;
    border:1px solid #cbd5f5;
    font-size:16px;
}

/* ===== STUDENT LIST ===== */
#studentResults div{
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
}
#studentResults div:hover{
    background:#e0f2fe;
}

/* ===== CALENDAR ===== */
.calendar{
    background:white;
    padding:22px;
    border-radius:18px;
    box-shadow:0 8px 18px rgba(0,0,0,.1);
}

.month-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
}

.month-bar button{
    padding:8px 16px;
    border:none;
    border-radius:8px;
    background:#3b82f6;
    color:white;
    cursor:pointer;
}

.days{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:10px;
}
.day{
    padding:14px;
    text-align:center;
    border-radius:12px;
    font-weight:600;
}
.present{background:#bbf7d0;color:#065f46}
.absent{background:#fecaca;color:#7f1d1d}
.empty{background:#e5e7eb;color:#6b7280}
</style>
</head>

<body>

<div class="container">

<!-- ===== SIDEBAR ===== -->
<div class="sidebar">
    <h2>üë©‚Äçüè´ Faculty</h2>

    <div class="profile">
        <strong>{{ request.user.username }}</strong>
        <p>{{ faculty.department.name }}</p>
    </div>

    <a href="{% url 'faculty_dashboard' %}">üè† Dashboard</a>
    <a href="{% url 'add_student' %}">‚ûï Add Student</a>
    <a href="{% url 'edit_attendance' %}">üìù Edit Attendance</a>
    <a href="{% url 'capture_page' %}">üì∏ Face Record</a>
    <a href="/recognize/">üì∏ Live Recognition</a>
    <a href="{% url 'logout' %}">üö™ Logout</a>
</div>

<!-- ===== MAIN ===== -->
<div class="main">

<div class="header">
    <h1>Faculty Dashboard</h1>
</div>

<!-- ===== SUMMARY ===== -->
<div class="cards">
    <div class="card green">
        <h3>Total Students</h3>
        <p>{{ total_students }}</p>
    </div>
    <div class="card blue">
        <h3>Present Today</h3>
        <p>{{ today_present }}</p>
    </div>
    <div class="card red">
        <h3>Absent Today</h3>
        <p>{{ today_absent }}</p>
    </div>
</div>

<!-- ===== SEARCH ===== -->
<div class="search-box">
    <h3>üîç Search Student</h3>
    <input type="text" id="studentSearch" placeholder="Type student name...">
    <div id="studentResults"></div>
</div>

<!-- ===== CALENDAR ===== -->
<div class="calendar">
    <h3 id="studentTitle">Select student to view attendance</h3>

    <div class="month-bar">
        <button onclick="changeMonth(-1)">‚óÄ</button>
        <strong id="monthLabel"></strong>
        <button onclick="changeMonth(1)">‚ñ∂</button>
    </div>

    <div class="days" id="calendarDays"></div>
</div>

</div>
</div>

<script>
const students = {{ students|safe }};
const attendanceData = {{ attendance_data|safe }};

let selectedStudent = null;
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

const searchInput = document.getElementById("studentSearch");
const resultsBox = document.getElementById("studentResults");
const calendarDays = document.getElementById("calendarDays");
const studentTitle = document.getElementById("studentTitle");
const monthLabel = document.getElementById("monthLabel");

updateMonthLabel();

searchInput.addEventListener("input", ()=>{
    const q = searchInput.value.toLowerCase();
    resultsBox.innerHTML = "";
    if(!q) return;

    students.filter(s=>s.name.toLowerCase().includes(q))
    .forEach(s=>{
        const div=document.createElement("div");
        div.innerText = `${s.name} (${s.roll_no})`;
        div.onclick=()=>selectStudent(s);
        resultsBox.appendChild(div);
    });
});

function selectStudent(s){
    selectedStudent = s;
    studentTitle.innerText = `üìÖ Attendance of ${s.name}`;
    resultsBox.innerHTML="";
    searchInput.value=s.name;
    renderCalendar();
}

function changeMonth(step){
    currentMonth+=step;
    if(currentMonth<0){currentMonth=11;currentYear--}
    if(currentMonth>11){currentMonth=0;currentYear++}
    updateMonthLabel();
    if(selectedStudent) renderCalendar();
}

function updateMonthLabel(){
    monthLabel.innerText =
      new Date(currentYear,currentMonth).toLocaleString('default',{month:'long'})+
      " "+currentYear;
}

function renderCalendar(){
    calendarDays.innerHTML="";
    const daysInMonth = new Date(currentYear,currentMonth+1,0).getDate();

    for(let d=1; d<=daysInMonth; d++){
        const dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const status = attendanceData[selectedStudent.id]?.[dateStr];

        const div=document.createElement("div");
        div.classList.add("day");
        if(status==="Present")div.classList.add("present");
        else if(status==="Absent")div.classList.add("absent");
        else div.classList.add("empty");

        div.innerText=d;
        calendarDays.appendChild(div);
    }
}
</script>

</body>
</html>
